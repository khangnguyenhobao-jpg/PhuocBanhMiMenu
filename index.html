<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Phước Bánh Mì Menu</title>
  <meta name="description" content="Menu Phước Bánh Mì - chọn ngôn ngữ để xem menu (PDF)"/>
  <style>
    :root{
      --bg:#f7f7f7;--card:#fff;--accent:#E94E1B;--muted:#666;
    }
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#111}
    .wrap{max-width:560px;margin:36px auto;padding:18px;background:var(--card);border-radius:12px;box-shadow:0 6px 30px rgba(16,24,40,0.06);text-align:center}

    /* HERO: avatar + static speech bubble */
.wrap { position: relative; }

/* Hero layout: avatar left, text on right (swap order via order) */
.hero{
  display:flex;
  align-items:center;
  gap:16px;
  justify-content:flex-start;
  margin-bottom:8px; /* keep a little space before language grid */
}

/* Force avatar block to appear before text even if HTML order different */
.hero-avatar{ order:-1; position:relative; flex:0 0 auto; }

/* Avatar: square, larger, slight rounded corners (not circular) */
.avatar{
  width:120px;            /* larger */
  height:120px;           /* square */
  border-radius:10px;     /* small radius for rounded-square look */
  object-fit:cover;
  border:3px solid #fff;
  box-shadow:0 8px 24px rgba(0,0,0,0.12);
  display:block;
}

/* Speech bubble: static, extended horizontally to the right of avatar */
/* Place it to the right of the avatar and keep it inside the top area so it
   does not overlap language buttons below. */
.speech-bubble{
  position:relative;      /* remain in flow of hero-avatar */
  display:block;
  margin-left:14px;       /* space from avatar */
  max-width:calc(100% - 160px); /* avoid exceeding container (responsive) */
  min-width:220px;
  background:#fff;
  color:#111;
  padding:12px 14px;
  border-radius:10px;
  box-shadow:0 8px 24px rgba(16,24,40,0.08);
  font-weight:600;
  font-size:0.98rem;
  line-height:1.2;
  opacity:1;              /* no animation, always visible */
  transform:none;
}

/* Arrow on bubble pointing to avatar */
.speech-bubble::after{
  content:"";
  position:absolute;
  left:-8px;
  top:50%;
  transform:translateY(-50%);
  border-width:8px 8px 8px 0;
  border-style:solid;
  border-color:transparent #ffffff transparent transparent;
  filter:drop-shadow(-2px 2px 2px rgba(0,0,0,0.03));
}

/* Prevent bubble from overlapping the language grid by adding spacing */
.langs{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
  margin-top:18px; /* extra space so bubble doesn't cover the buttons */
}

/* Smaller screens: stack hero vertically; keep avatar left-ish and bubble above buttons */
@media (max-width:520px){
  .hero{flex-direction:row; align-items:center;} /* keep row to keep avatar left */
  .avatar{width:96px;height:96px;}              /* slightly smaller on mobile */
  .speech-bubble{
    max-width:220px;
    margin-left:10px;
    font-size:0.95rem;
  }
  .langs{margin-top:22px;}
}
  </style>
</head>
<body>
  <div class="wrap" role="main" aria-labelledby="title">
    <!-- HERO: avatar + static speech bubble -->
    <div class="hero" aria-hidden="false">
      <div class="hero-text" role="heading" aria-level="1">
        <h1 id="title">Phước Bánh Mì Bonjour</h1>
        <p>Choose your language</p>
      </div>

      <div class="hero-avatar" aria-hidden="false">
        <!-- Upload avatar.jpg into repo root or change src to your path -->
        <img class="avatar" src="avatar.jpg" alt="Ảnh Phước Bánh Mì">
        <div class="speech-bubble" role="status" aria-live="polite">
          Phước Bánh Mì Bonjour, Please choose your language
        </div>
      </div>
    </div>

    <div class="langs" id="langList">
      <a class="btn" href="menu_vi.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/vn.svg" alt="Cờ Việt Nam">
        <span class="label">Tiếng Việt</span>
      </a>

      <a class="btn" href="menu_fr.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/fr.svg" alt="Drapeau France">
        <span class="label">Français</span>
      </a>

      <a class="btn" href="menu_en.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/gb.svg" alt="United Kingdom">
        <span class="label">English</span>
      </a>

      <a class="btn" href="menu_ja.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/jp.svg" alt="日本国旗">
        <span class="label">日本語</span>
      </a>

      <a class="btn" href="menu_ko.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/kr.svg" alt="대한민국 국기">
        <span class="label">한국어</span>
      </a>

      <a class="btn" href="menu_zh.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/cn.svg" alt="中国国旗">
        <span class="label">简体中文</span>
      </a>

      <a class="btn" href="menu_tw.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/tw.svg" alt="台灣">
        <span class="label">繁體中文</span>
      </a>

      <a class="btn" href="menu_it.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/it.svg" alt="Bandiera Italia">
        <span class="label">Italiano</span>
      </a>

      <a class="btn" href="menu_es.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/es.svg" alt="Bandera España">
        <span class="label">Español</span>
      </a>

      <a class="btn" href="menu_pt.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/pt.svg" alt="Bandeira Portugal">
        <span class="label">Português</span>
      </a>

      <a class="btn" href="menu_sv.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/se.svg" alt="Sverige flagga">
        <span class="label">Svenska</span>
      </a>

      <a class="btn" href="menu_de.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/de.svg" alt="Deutschland flagge">
        <span class="label">Deutsch</span>
      </a>

      <a class="btn" href="menu_ru.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/ru.svg" alt="Флаг России">
        <span class="label">Русский</span>
      </a>

      <a class="btn" href="menu_hi.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/in.svg" alt="India flag">
        <span class="label">हिंदी</span>
      </a>
    </div>

    <div class="small"> If you don't find your language, feel free to tell us to add it!</div>
    <div class="small"> If you find any error in the translation, please tell us!</div>
  </div>

  <!-- Modal viewer -->
  <div id="pdfModal" role="dialog" aria-hidden="true">
    <div id="pdfContainer">
      <div class="modalHeader">
        <button id="openTab" class="btnOpenTab" title="Mở ở tab mới">Mở tab</button>
        <button id="pdfClose" class="btnClose" title="Đóng">Đóng</button>
      </div>
      <iframe id="pdfFrame" src="" frameborder="0" aria-label="PDF viewer"></iframe>

      <!-- Footer link as fallback for browsers that can't render in iframe -->
      <div class="modalFooter">
        <a id="directPdfLink" href="#" target="_blank" rel="noopener">M�� file ở tab mới</a>
      </div>
    </div>
  </div>

  <script>
  // Path tới PDF.js viewer (local trong repo)
  const PDFJS_VIEWER = '/pdfjs/web/viewer.html';

  // Kiểm tra nhanh xem PDF.js viewer có sẵn không (HEAD request). Kết quả được cache.
  let _pdfjsAvailable = null;
  async function pdfjsAvailable() {
    if (_pdfjsAvailable !== null) return _pdfjsAvailable;
    try {
      const res = await fetch(PDFJS_VIEWER, { method: 'HEAD' });
      _pdfjsAvailable = res.ok;
    } catch (e) {
      _pdfjsAvailable = false;
    }
    return _pdfjsAvailable;
  }

  // Helper: detect iOS devices (iPhone/iPad/iPod)
  function isIOS() {
    return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
  }

  const modal = document.getElementById('pdfModal');
  const frame = document.getElementById('pdfFrame'); // iframe trong modal
  const closeBtn = document.getElementById('pdfClose');
  const openTabBtn = document.getElementById('openTab');
  const directLink = document.getElementById('directPdfLink');

  function normalizePath(path) {
    return path.startsWith('/') ? path : '/' + path;
  }

  function viewerUrlFor(pdfPath) {
    const normalized = normalizePath(pdfPath);
    return PDFJS_VIEWER + '?file=' + encodeURIComponent(normalized);
  }

  // Open modal and set iframe src (fallback)
  function showModalWithPdf(url) {
    if (frame) frame.src = url;
    if (directLink) directLink.href = url;
    if (modal) {
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden', 'false');
    }
  }

  function closePdf() {
    if (frame) frame.src = '';
    if (modal) {
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden', 'true');
    }
  }

  // Main open logic: prefer PDF.js viewer if available (open in new tab).
  // Otherwise: on iOS open direct in new tab; on others use modal iframe.
  async function openPdf(url) {
    const isExternal = /^https?:\/\//i.test(url) && (new URL(url, location.href).origin !== location.origin);

    // If external host, just open new tab
    if (isExternal) {
      window.open(url, '_blank', 'noopener');
      return;
    }

    const pdfjsOk = await pdfjsAvailable();

    if (pdfjsOk) {
      // Use PDF.js viewer (open new tab)
      const v = viewerUrlFor(url);
      window.open(v, '_blank', 'noopener');
      return;
    }

    // If no pdf.js:
    if (isIOS()) {
      // iOS: open direct in new tab (iframe unreliable)
      window.open(url, '_blank', 'noopener');
      return;
    }

    // Desktop/Android fallback: show modal iframe
    showModalWithPdf(url);
  }

  // Delegated click handler for links with data-pdf
  document.addEventListener('click', function (e) {
    const a = e.target.closest('a[data-pdf]');
    if (!a) return;
    e.preventDefault();
    const url = a.getAttribute('href');
    openPdf(url);
  });

  // Close handlers
  if (closeBtn) closeBtn.addEventListener('click', closePdf);
  if (openTabBtn) openTabBtn.addEventListener('click', async function () {
    // If PDF.js available open via viewer, else open current iframe src
    const pdfjsOk = await pdfjsAvailable();
    const current = frame && frame.src ? frame.src : (directLink && directLink.href ? directLink.href : '');
    if (pdfjsOk) {
      if (current) {
        // normalize path if same origin
        try {
          const u = new URL(current, location.href);
          window.open(viewerUrlFor(u.pathname + u.search + u.hash), '_blank', 'noopener');
        } catch (e) {
          window.open(current, '_blank', 'noopener');
        }
      }
    } else {
      if (current) window.open(current, '_blank', 'noopener');
    }
  });

  // Close on Escape and click outside to close
  document.addEventListener('keydown', function (e) { if (e.key === 'Escape') closePdf(); });
  if (modal) modal.addEventListener('click', function (e) { if (e.target === modal) closePdf(); });

  // Optional: prime pdfjsAvailable check in background so first click is faster
  pdfjsAvailable();
</script>
</body>
</html>
