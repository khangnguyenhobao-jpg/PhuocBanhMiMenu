<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Phước Bánh Mì Menu</title>
  <meta name="description" content="Menu Phước Bánh Mì - chọn ngôn ngữ để xem menu (PDF)"/>
  <style>
    :root{
      --bg:#f7f7f7;--card:#fff;--accent:#E94E1B;--muted:#666;
    }
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#111}
    .wrap{max-width:560px;margin:36px auto;padding:18px;background:var(--card);border-radius:12px;box-shadow:0 6px 30px rgba(16,24,40,0.06);text-align:center}

    /* HERO: avatar + static speech bubble */
    .hero{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
    }
    .hero-text{flex:1;text-align:left}
    .hero-text h1{margin:0;font-size:1.3rem}
    .hero-text p{margin:6px 0 0;color:var(--muted)}
    .hero-avatar{position:relative;flex:0 0 auto;display:flex;align-items:center;gap:10px}
    .avatar{width:72px;height:72px;border-radius:50%;object-fit:cover;border:3px solid #fff;box-shadow:0 6px 18px rgba(0,0,0,0.12)}
    .speech-bubble{
      position:absolute;
      top:-4px;
      right:100%;
      margin-right:10px;
      max-width:260px;
      background:#ffffff;
      color:#111;
      padding:10px 12px;
      border-radius:10px;
      box-shadow:0 6px 20px rgba(16,24,40,0.08);
      font-weight:600;
      font-size:0.95rem;
      line-height:1.15;
      opacity:1;
      transform:none;
    }
    .speech-bubble::after{
      content:"";
      position:absolute;
      right:-8px;
      top:50%;
      transform:translateY(-50%);
      border-width:8px 0 8px 8px;
      border-style:solid;
      border-color:transparent transparent transparent #ffffff;
      filter:drop-shadow(-2px 2px 2px rgba(0,0,0,0.04));
    }
    @media (max-width:520px){
      .hero{flex-direction:column;align-items:flex-start}
      .hero-avatar{align-self:flex-end}
      .speech-bubble{right:0;left:auto;top:auto;bottom:110%;margin-right:0}
      .speech-bubble::after{right:14px;top:auto;bottom:-8px;transform:none;border-width:0 8px 8px 8px;border-color:transparent transparent #ffffff transparent}
    }

    /* language grid */
    .langs{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .btn{
      display:flex;align-items:center;justify-content:center;gap:10px;padding:12px;border-radius:10px;border:1px solid #eee;background:#fff;font-weight:700;color:#111;text-decoration:none;box-shadow:0 2px 6px rgba(16,24,40,0.04)
    }
    .btn:active{transform:translateY(1px)}
    .flag{width:28px;height:20px;border-radius:4px;flex-shrink:0;object-fit:cover;background:#eee}
    .label{margin-left:6px}
    .small{font-size:0.9rem;color:var(--muted);margin-top:12px}
    @media (max-width:420px){.langs{grid-template-columns:1fr;gap:10px}}

    /* Modal / viewer */
    #pdfModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:9999;align-items:center;justify-content:center;padding:12px}
    #pdfContainer{position:relative;width:100%;height:100%;max-width:1000px;max-height:100vh;background:#fff;border-radius:6px;overflow:hidden;}
    #pdfFrame{width:100%;height:100%;border:0;background:#fff}
    .modalHeader{position:absolute;right:8px;top:8px;z-index:2;display:flex;gap:8px}
    .btnClose{background:rgba(0,0,0,0.6);color:#fff;border:0;padding:8px 10px;border-radius:6px;font-weight:700}
    .btnOpenTab{background:rgba(255,255,255,0.95);color:#111;border:0;padding:8px 10px;border-radius:6px;font-weight:700}
    .modalFooter{position:absolute;left:12px;bottom:12px;right:12px;text-align:center;padding:8px 0}
    .modalFooter a{color:var(--accent);font-weight:600;text-decoration:none}
    /* Mobile full-screen */
    @media (max-width:820px){
      #pdfContainer{width:100%;height:100%;border-radius:0}
      .btnClose{padding:10px}
    }
  </style>
</head>
<body>
  <div class="wrap" role="main" aria-labelledby="title">
    <!-- HERO: avatar + static speech bubble -->
    <div class="hero" aria-hidden="false">
      <div class="hero-text" role="heading" aria-level="1">
        <h1 id="title">Phước Bánh Mì Bonjour</h1>
        <p>Choose your language</p>
      </div>
      </div>
    </div>

    <div class="langs" id="langList">
      <a class="btn" href="menu_vi.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/vn.svg" alt="Cờ Việt Nam">
        <span class="label">Tiếng Việt</span>
      </a>

      <a class="btn" href="menu_fr.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/fr.svg" alt="Drapeau France">
        <span class="label">Français</span>
      </a>

      <a class="btn" href="menu_en.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/gb.svg" alt="United Kingdom">
        <span class="label">English</span>
      </a>

      <a class="btn" href="menu_ja.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/jp.svg" alt="日本国旗">
        <span class="label">日本語</span>
      </a>

      <a class="btn" href="menu_ko.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/kr.svg" alt="대한민국 국기">
        <span class="label">한국어</span>
      </a>

      <a class="btn" href="menu_zh.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/cn.svg" alt="中国国旗">
        <span class="label">简体中文</span>
      </a>

      <a class="btn" href="menu_tw.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/tw.svg" alt="台灣">
        <span class="label">繁體中文</span>
      </a>

      <a class="btn" href="menu_it.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/it.svg" alt="Bandiera Italia">
        <span class="label">Italiano</span>
      </a>

      <a class="btn" href="menu_es.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/es.svg" alt="Bandera España">
        <span class="label">Español</span>
      </a>

      <a class="btn" href="menu_pt.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/pt.svg" alt="Bandeira Portugal">
        <span class="label">Português</span>
      </a>

      <a class="btn" href="menu_sv.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/se.svg" alt="Sverige flagga">
        <span class="label">Svenska</span>
      </a>

      <a class="btn" href="menu_de.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/de.svg" alt="Deutschland flagge">
        <span class="label">Deutsch</span>
      </a>

      <a class="btn" href="menu_ru.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/ru.svg" alt="Флаг России">
        <span class="label">Русский</span>
      </a>

      <a class="btn" href="menu_hi.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/in.svg" alt="India flag">
        <span class="label">हिंदी</span>
      </a>
    </div>

    <div class="small"> If you don't find your language, feel free to tell us to add it!</div>
    <div class="small"> If you find any error in the translation, please tell us!</div>
  </div>

  <!-- Modal viewer -->
  <div id="pdfModal" role="dialog" aria-hidden="true">
    <div id="pdfContainer">
      <div class="modalHeader">
        <button id="openTab" class="btnOpenTab" title="Mở ở tab mới">Mở tab</button>
        <button id="pdfClose" class="btnClose" title="Đóng">Đóng</button>
      </div>
      <iframe id="pdfFrame" src="" frameborder="0" aria-label="PDF viewer"></iframe>

      <!-- Footer link as fallback for browsers that can't render in iframe -->
      <div class="modalFooter">
        <a id="directPdfLink" href="#" target="_blank" rel="noopener">M�� file ở tab mới</a>
      </div>
    </div>
  </div>

  <script>
  // Path tới PDF.js viewer (local trong repo)
  const PDFJS_VIEWER = '/pdfjs/web/viewer.html';

  // Kiểm tra nhanh xem PDF.js viewer có sẵn không (HEAD request). Kết quả được cache.
  let _pdfjsAvailable = null;
  async function pdfjsAvailable() {
    if (_pdfjsAvailable !== null) return _pdfjsAvailable;
    try {
      const res = await fetch(PDFJS_VIEWER, { method: 'HEAD' });
      _pdfjsAvailable = res.ok;
    } catch (e) {
      _pdfjsAvailable = false;
    }
    return _pdfjsAvailable;
  }

  // Helper: detect iOS devices (iPhone/iPad/iPod)
  function isIOS() {
    return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
  }

  const modal = document.getElementById('pdfModal');
  const frame = document.getElementById('pdfFrame'); // iframe trong modal
  const closeBtn = document.getElementById('pdfClose');
  const openTabBtn = document.getElementById('openTab');
  const directLink = document.getElementById('directPdfLink');

  function normalizePath(path) {
    return path.startsWith('/') ? path : '/' + path;
  }

  function viewerUrlFor(pdfPath) {
    const normalized = normalizePath(pdfPath);
    return PDFJS_VIEWER + '?file=' + encodeURIComponent(normalized);
  }

  // Open modal and set iframe src (fallback)
  function showModalWithPdf(url) {
    if (frame) frame.src = url;
    if (directLink) directLink.href = url;
    if (modal) {
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden', 'false');
    }
  }

  function closePdf() {
    if (frame) frame.src = '';
    if (modal) {
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden', 'true');
    }
  }

  // Main open logic: prefer PDF.js viewer if available (open in new tab).
  // Otherwise: on iOS open direct in new tab; on others use modal iframe.
  async function openPdf(url) {
    const isExternal = /^https?:\/\//i.test(url) && (new URL(url, location.href).origin !== location.origin);

    // If external host, just open new tab
    if (isExternal) {
      window.open(url, '_blank', 'noopener');
      return;
    }

    const pdfjsOk = await pdfjsAvailable();

    if (pdfjsOk) {
      // Use PDF.js viewer (open new tab)
      const v = viewerUrlFor(url);
      window.open(v, '_blank', 'noopener');
      return;
    }

    // If no pdf.js:
    if (isIOS()) {
      // iOS: open direct in new tab (iframe unreliable)
      window.open(url, '_blank', 'noopener');
      return;
    }

    // Desktop/Android fallback: show modal iframe
    showModalWithPdf(url);
  }

  // Delegated click handler for links with data-pdf
  document.addEventListener('click', function (e) {
    const a = e.target.closest('a[data-pdf]');
    if (!a) return;
    e.preventDefault();
    const url = a.getAttribute('href');
    openPdf(url);
  });

  // Close handlers
  if (closeBtn) closeBtn.addEventListener('click', closePdf);
  if (openTabBtn) openTabBtn.addEventListener('click', async function () {
    // If PDF.js available open via viewer, else open current iframe src
    const pdfjsOk = await pdfjsAvailable();
    const current = frame && frame.src ? frame.src : (directLink && directLink.href ? directLink.href : '');
    if (pdfjsOk) {
      if (current) {
        // normalize path if same origin
        try {
          const u = new URL(current, location.href);
          window.open(viewerUrlFor(u.pathname + u.search + u.hash), '_blank', 'noopener');
        } catch (e) {
          window.open(current, '_blank', 'noopener');
        }
      }
    } else {
      if (current) window.open(current, '_blank', 'noopener');
    }
  });

  // Close on Escape and click outside to close
  document.addEventListener('keydown', function (e) { if (e.key === 'Escape') closePdf(); });
  if (modal) modal.addEventListener('click', function (e) { if (e.target === modal) closePdf(); });

  // Optional: prime pdfjsAvailable check in background so first click is faster
  pdfjsAvailable();
</script>
</body>
</html>
