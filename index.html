<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Phước Bánh Mì Menu</title>
  <meta name="description" content="Menu Phước Bánh Mì - chọn ngôn ngữ để xem menu (PDF)"/>
  <style>
    :root{
      --bg:#f7f7f7;--card:#fff;--accent:#E94E1B;--muted:#666;
    }
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#111}
    .wrap{max-width:560px;margin:36px auto;padding:18px;background:var(--card);border-radius:12px;box-shadow:0 6px 30px rgba(16,24,40,0.06);text-align:center}
    h1{margin:0 0 6px;font-size:1.3rem}
    p{margin:0 0 18px;color:var(--muted)}
    .langs{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .btn{
      display:flex;align-items:center;justify-content:center;gap:10px;padding:12px;border-radius:10px;border:1px solid #eee;background:#fff;font-weight:700;color:#111;text-decoration:none;box-shadow:0 2px 6px rgba(16,24,40,0.04)
    }
    .btn:active{transform:translateY(1px)}
    .flag{width:28px;height:20px;border-radius:4px;flex-shrink:0;object-fit:cover;background:#eee}
    .small{font-size:0.9rem;color:var(--muted);margin-top:12px}
    @media (max-width:420px){.langs{grid-template-columns:1fr;gap:10px}}

    /* Modal / viewer */
    #pdfModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:9999;align-items:center;justify-content:center}
    #pdfContainer{position:relative;width:100%;height:100%;max-width:1000px;max-height:100vh;background:#fff;border-radius:6px;overflow:hidden;}
    #pdfFrame{width:100%;height:100%;border:0;background:#fff}
    .modalHeader{position:absolute;right:8px;top:8px;z-index:2;display:flex;gap:8px}
    .btnClose{background:rgba(0,0,0,0.6);color:#fff;border:0;padding:8px 10px;border-radius:6px;font-weight:700}
    .btnOpenTab{background:rgba(255,255,255,0.95);color:#111;border:0;padding:8px 10px;border-radius:6px;font-weight:700}
    /* Mobile full-screen */
    @media (max-width:820px){
      #pdfContainer{width:100%;height:100%;border-radius:0}
      .btnClose{padding:10px}
  /* Avatar inline bên trái tiêu đề */
.title-row{
  display: flex;
  flex-direction: column;   /* LUÔN stack dọc */
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-bottom: 12px;
}

/* Avatar theo style mobile */
.avatar-inline{
  width: 160px;
  height: 160px;
  object-fit: none
  border-radius: 8px;
  align-items: center;
  border: 3px solid #fff;
  box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  display: block;
}

/* Text luôn căn giữa */
.title-text{
  text-align: center;
}

  </style>
</head>
<body>
<div class="title-row">
  <img class="avatar-inline" src="avatar.jpg" alt="Ảnh Chú Phước">
  <div class="title-text">
    <h1 id="title">Phước Bánh Mì Bonjour</h1>
    <p>Choose your language</p>


    <div class="langs" id="langList">
      <a class="btn" href="menu_vi.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/vn.svg" alt="Cờ Việt Nam">
        <span class="label">Tiếng Việt</span>
      </a>
      
      <a class="btn" href="menu_fr.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/fr.svg" alt="Drapeau France">
        <span class="label"> Français</span>
     </a>
      
      <a class="btn" href="menu_en.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/gb.svg" alt="Flag USA">
        <span class="label">English</span>
      </a>
      
      <a class="btn" href="menu_ja.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/jp.svg" alt="日本国旗">
        <span class="label">日本語</span>
      </a>
      
      <a class="btn" href="menu_ko.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/kr.svg" alt="대한민국 국기">
        <span class="label">한국어</span>
      </a>
      
      <a class="btn" href="menu_zh.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/cn.svg" alt="中国国旗">
        <span class="label">简体中文  </span>
      </a>

      <a class="btn" href="menu_tw.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/tw.svg" alt="旗袍">
        <span class="label"> 繁體中文 </span>
      </a>

      <a class="btn" href="menu_it.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/it.svg" alt="Bandiera Italia">
        <span class="label"> Italiano </span>
      </a>

      <a class="btn" href="menu_es.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/es.svg" alt="Bandera España">
        <span class="label">Español </span>
      </a>

      <a class="btn" href="menu_pt.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/pt.svg" alt="Bandeira Portugal">
        <span class="label">Português</span>
      </a>

      <a class="btn" href="menu_sv.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/se.svg" alt="Sverige flagga">
        <span class="label">Svenska</span>
      </a>

      <a class="btn" href="menu_de.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/de.svg" alt="Deutschland flagge">
        <span class="label">Deutsch</span>
      </a>

      <a class="btn" href="menu_ru.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/ru.svg" alt="Флаг России">
        <span class="label">Русский</span>
      </a>

      <a class="btn" href="menu_hi.pdf" data-pdf>
        <img class="flag" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@latest/svg/in.svg" alt="India flag">
        <span class="label">हिंदी</span>
      </a>
      
    </div>

    <div class="small"> If you don't found your language, feel free to tell us to add it !</div>
    <div class="small"> If you found any error in the translation, please tell us !</div>

  </div>

  <!-- Modal viewer -->
  <div id="pdfModal" role="dialog" aria-hidden="true">
    <div id="pdfContainer">
      <div class="modalHeader">
        <button id="openTab" class="btnOpenTab" title="Mở ở tab mới">Mở tab</button>
        <button id="pdfClose" class="btnClose" title="Đóng">Đóng</button>
      </div>
      <iframe id="pdfFrame" src="" frameborder="0" aria-label="PDF viewer"></iframe>
    </div>
  </div>

  <script>
  // Path tới PDF.js viewer (local trong repo)
  const PDFJS_VIEWER = '/pdfjs/web/viewer.html';

  // Kiểm tra nhanh xem PDF.js viewer có sẵn không (HEAD request). Kết quả được cache.
  let _pdfjsAvailable = null;
  async function pdfjsAvailable() {
    if (_pdfjsAvailable !== null) return _pdfjsAvailable;
    try {
      const res = await fetch(PDFJS_VIEWER, { method: 'HEAD' });
      _pdfjsAvailable = res.ok;
    } catch (e) {
      _pdfjsAvailable = false;
    }
    return _pdfjsAvailable;
  }

  // Helper: detect iOS devices (iPhone/iPad/iPod)
  function isIOS() {
    return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
  }

  const modal = document.getElementById('pdfModal');
  const frame = document.getElementById('pdfFrame'); // iframe trong modal
  const closeBtn = document.getElementById('pdfClose');
  const openTabBtn = document.getElementById('openTab');
  const directLink = document.getElementById('directPdfLink');

  function normalizePath(path) {
    return path.startsWith('/') ? path : '/' + path;
  }

  function viewerUrlFor(pdfPath) {
    const normalized = normalizePath(pdfPath);
    return PDFJS_VIEWER + '?file=' + encodeURIComponent(normalized);
  }

  // Open modal and set iframe src (fallback)
  function showModalWithPdf(url) {
    frame.src = url;
    directLink.href = url;
    modal.style.display = 'flex';
    modal.setAttribute('aria-hidden', 'false');
  }

  function closePdf() {
    if (frame) frame.src = '';
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden', 'true');
  }

  // Main open logic: prefer PDF.js viewer if available (open in new tab).
  // Otherwise: on iOS open direct in new tab; on others use modal iframe.
  async function openPdf(url) {
    const isExternal = /^https?:\/\//i.test(url) && (new URL(url, location.href).origin !== location.origin);

    // If external host, just open new tab
    if (isExternal) {
      window.open(url, '_blank', 'noopener');
      return;
    }

    const pdfjsOk = await pdfjsAvailable();

    if (pdfjsOk) {
      // Use PDF.js viewer (open new tab)
      const v = viewerUrlFor(url);
      window.open(v, '_blank', 'noopener');
      return;
    }

    // If no pdf.js:
    if (isIOS()) {
      // iOS: open direct in new tab (iframe unreliable)
      window.open(url, '_blank', 'noopener');
      return;
    }

    // Desktop/Android fallback: show modal iframe
    showModalWithPdf(url);
  }

  // Delegated click handler for links with data-pdf
  document.addEventListener('click', function (e) {
    const a = e.target.closest('a[data-pdf]');
    if (!a) return;
    e.preventDefault();
    const url = a.getAttribute('href');
    openPdf(url);
  });

  // Close handlers
  if (closeBtn) closeBtn.addEventListener('click', closePdf);
  if (openTabBtn) openTabBtn.addEventListener('click', async function () {
    // If PDF.js available open via viewer, else open current iframe src
    const pdfjsOk = await pdfjsAvailable();
    if (pdfjsOk) {
      // if iframe has a src (direct pdf), convert to viewer URL
      const current = frame && frame.src ? frame.src : (directLink && directLink.href ? directLink.href : '');
      if (current) {
        const normalized = normalizePath(new URL(current, location.href).pathname);
        window.open(viewerUrlFor(normalized), '_blank', 'noopener');
      }
    } else {
      const url = frame && frame.src ? frame.src : (directLink && directLink.href ? directLink.href : '');
      if (url) window.open(url, '_blank', 'noopener');
    }
  });

  // Close on Escape and click outside to close
  document.addEventListener('keydown', function (e) { if (e.key === 'Escape') closePdf(); });
  if (modal) modal.addEventListener('click', function (e) { if (e.target === modal) closePdf(); });

  // Optional: prime pdfjsAvailable check in background so first click is faster
  pdfjsAvailable();
</script>
</body>
</html>
